<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PowerIndex - Accuracy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --bg: #050816;
      --border-subtle: rgba(148, 163, 184, 0.55);
      --text-main: #e5e7eb;
      --text-muted: #6b7280;
      --accent: #3b82f6;

      --font-main: "JetBrains Mono", monospace;
      --font-size-base: 10px;
      --font-size-small: 9px;
      --font-size-header: 14px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-main);
      font-size: var(--font-size-base);
      background: var(--bg);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
      padding: 12px 14px;
      max-width: 720px;
      line-height: 1.35;
    }

    h1 {
      font-size: var(--font-size-header);
      font-weight: 600;
      margin-bottom: 6px;
    }

    h2 {
      font-size: 12px;
      font-weight: 600;
      margin: 12px 0 4px 0;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
    }

    p {
      margin: 6px 0 10px 0;
      color: var(--text-main);
    }

    ul {
      margin: 4px 0 10px 16px;
      padding: 0;
      color: var(--text-main);
    }

    li {
      margin: 3px 0;
    }

    nav {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      font-size: var(--font-size-base);
    }

    nav a {
      color: var(--text-main);
      text-decoration: none;
      padding: 4px 6px;
      border: 1px solid var(--border-subtle);
      border-radius: 3px;
      background: #0b1024;
    }

    nav a:hover {
      border-color: var(--accent);
      color: var(--text-main);
    }

    nav .active {
      border-color: var(--accent);
      color: var(--text-main);
      background: rgba(59, 130, 246, 0.15);
    }

    .note {
      color: var(--text-muted);
      font-size: var(--font-size-small);
      margin-top: 8px;
    }

    .card {
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      padding: 10px;
      background: #0b1024;
      margin-bottom: 10px;
    }

    .label {
      color: var(--text-muted);
      font-size: var(--font-size-small);
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .metric {
      font-size: 12px;
      font-weight: 600;
      margin-top: 4px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .grid .item {
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      padding: 8px;
      background: #0b1024;
    }

    .grid .item .label {
      font-size: var(--font-size-small);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      border: 1px solid var(--border-subtle);
    }

    th, td {
      border: 1px solid var(--border-subtle);
      padding: 6px 8px;
      text-align: left;
      font-size: var(--font-size-base);
    }

    th {
      background: #0b1024;
      color: var(--text-main);
      font-weight: 600;
    }
  </style>
</head>
<body>
  <nav>
    <a href="./index.html">Rankings</a>
    <a href="./methodology.html">Methodology</a>
    <a href="./accuracy.html" class="active">Accuracy</a>
    <a href="./about.html">About</a>
  </nav>

  <h1>PowerIndex Track Record</h1>
  <p class="note" style="margin-top: 2px; margin-bottom: 12px;">
    Public accuracy summary (non-betting).
  </p>

  <h2>Overview</h2>
  <p>
    This page will summarize recent alignment between PowerIndex ratings and on-court outcomes.
    It is meant as a quick reference, not a predictive guarantee.
  </p>

  <h2>Core metric</h2>
  <p>
    Higher-rated team win rate: the share of games where the team with the higher pre-game PowerIndex rating
    wins, using the most recent rating snapshot available at game time.
  </p>
  <p class="note">Directional only; not a guarantee of future results.</p>
  <p class="note">Policy: latest snapshot before game time; ties skipped; missing ratings skipped.</p>

  <h2>Snapshot</h2>
  <div class="grid">
    <div class="item">
      <div class="label">Season to date higher-rated win rate</div>
      <div class="metric" id="metric-std">__%</div>
    </div>
    <div class="item">
      <div class="label">Last 30 days higher-rated win rate</div>
      <div class="metric" id="metric-30">__%</div>
    </div>
    <div class="item">
      <div class="label">Last 7 days higher-rated win rate</div>
      <div class="metric" id="metric-7">__%</div>
    </div>
    <div class="item">
      <div class="label">Sample size</div>
      <div class="metric" id="metric-sample">__ games</div>
    </div>
  </div>
  <p class="note" id="metric-asof"></p>

  <h2>Season-by-season summary</h2>
  <table>
    <thead>
      <tr>
        <th>Season</th>
        <th>Higher-rated win %</th>
        <th>Games counted</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody id="season-table"></tbody>
  </table>

  <h2>New model accuracy</h2>
  <p>
    Compares the new model's line against final scores.
  </p>
  <div class="grid">
    <div class="item">
      <div class="label">Spread MAE (points)</div>
      <div class="metric" id="model-spread-mae">__</div>
    </div>
    <div class="item">
      <div class="label">Total MAE (points)</div>
      <div class="metric" id="model-total-mae">__</div>
    </div>
    <div class="item">
      <div class="label">Model winner hit rate</div>
      <div class="metric" id="model-win-rate">__%</div>
    </div>
    <div class="item">
      <div class="label">Sample size</div>
      <div class="metric" id="model-sample">__ games</div>
    </div>
    <div class="item">
      <div class="label">Spread RMSE (points)</div>
      <div class="metric" id="model-spread-rmse">__</div>
    </div>
    <div class="item">
      <div class="label">Total RMSE (points)</div>
      <div class="metric" id="model-total-rmse">__</div>
    </div>
    <div class="item">
      <div class="label">ATS cover rate</div>
      <div class="metric" id="model-ats-rate">__%</div>
    </div>
  </div>
  <p class="note" id="model-asof"></p>

  <h2>New model season breakdown</h2>
  <table>
    <thead>
      <tr>
        <th>Season</th>
        <th>Spread MAE</th>
        <th>Spread RMSE</th>
        <th>ATS cover %</th>
        <th>Total MAE</th>
        <th>Total RMSE</th>
      </tr>
    </thead>
    <tbody id="model-season-table"></tbody>
  </table>

  <h2>New model accuracy by spread bucket</h2>
  <table>
    <thead>
      <tr>
        <th>Bucket (abs spread)</th>
        <th>Hit rate</th>
        <th>Games</th>
      </tr>
    </thead>
    <tbody id="model-bucket-table"></tbody>
  </table>

  <h2>What this page measures</h2>
  <ul>
    <li>We compare the higher-rated team versus the lower-rated team at game time, using the latest snapshot available.</li>
    <li>We track how often the higher-rated team wins.</li>
    <li>We summarize how accuracy changes over time as new games arrive.</li>
    <li>We highlight whether larger rating gaps tend to align with outcomes more consistently.</li>
  </ul>

  <h2>Interpretation</h2>
  <ul>
    <li>Injuries and rotations are not modeled directly; recent games partly reflect who was available.</li>
    <li>Back-to-backs and travel are not explicitly modeled unless their impact is already embedded in results.</li>
    <li>Early season volatility can make short-term accuracy less stable.</li>
    <li>Model updates can shift ratings after new games are ingested.</li>
  </ul>

  <h2>What We Track</h2>
  <ul>
    <li>How often the higher-rated team wins (by date range).</li>
    <li>Average rating edge in games played.</li>
    <li>Distribution of results when ratings differ by tier.</li>
    <li>Longer-term stability (week-over-week rating movement).</li>
  </ul>

  <h2>Planned Metrics</h2>
  <div class="card">
    <div class="label">Higher-rated win rate</div>
    <div class="metric">Coming soon</div>
  </div>
  <div class="card">
    <div class="label">Average rating gap per game</div>
    <div class="metric">Coming soon</div>
  </div>
  <div class="card">
    <div class="label">Tier-vs-tier outcomes</div>
    <div class="metric">Coming soon</div>
  </div>
  <div class="card">
    <div class="label">Week-over-week drift</div>
    <div class="metric">Coming soon</div>
  </div>

  <h2>Disclaimer</h2>
  <p>
    Informational only; no guarantees are provided. This is not financial or betting advice, and it should not be relied on as the sole input for any decisions.
  </p>

  <p class="note">
    Data is updated alongside the daily rankings once metrics are wired in.
  </p>

  <script>
    const METRICS_URL = "./data/metrics/accuracy.json";
    const MODEL_METRICS_URL = "./data/metrics/new_model_accuracy.json";

    const fmtPct = (value) => {
      if (value === null || value === undefined) return "-";
      return `${(value * 100).toFixed(1)}%`;
    };

    const fmtNumber = (value, digits = 2) => {
      if (value === null || value === undefined) return "-";
      const num = Number(value);
      if (!Number.isFinite(num)) return "-";
      return num.toFixed(digits);
    };

    const fmtCount = (value) => {
      if (value === null || value === undefined) return "-";
      return `${value} games`;
    };

    const updateMetrics = (data) => {
      const overall = data.overall || {};
      document.getElementById("metric-std").textContent = fmtPct(overall.win_rate_total);
      document.getElementById("metric-30").textContent = fmtPct(overall.win_rate_last_30);
      document.getElementById("metric-7").textContent = fmtPct(overall.win_rate_last_7);
      document.getElementById("metric-sample").textContent = fmtCount(overall.games_total);

      const asOf = data.as_of_utc ? `As of ${data.as_of_utc}` : "";
      document.getElementById("metric-asof").textContent = asOf;

      const table = document.getElementById("season-table");
      table.innerHTML = "";
      const seasons = data.seasons || {};
      const seasonKeys = Object.keys(seasons).sort().reverse();
      for (const season of seasonKeys) {
        const row = seasons[season] || {};
        const tr = document.createElement("tr");
        const winRate = fmtPct(row.win_rate_total);
        const games = row.games_total ?? "—";
        tr.innerHTML = `
          <td>${season}</td>
          <td>${winRate}</td>
          <td>${games}</td>
          <td>Snapshot-based</td>
        `;
        table.appendChild(tr);
      }
    };

    const updateModelMetrics = (data) => {
      const spread = data.spread || {};
      const total = data.total || {};
      document.getElementById("model-spread-mae").textContent = fmtNumber(spread.mae);
      document.getElementById("model-total-mae").textContent = fmtNumber(total.mae);
      document.getElementById("model-spread-rmse").textContent = fmtNumber(spread.rmse);
      document.getElementById("model-total-rmse").textContent = fmtNumber(total.rmse);
      document.getElementById("model-ats-rate").textContent = fmtPct(spread.ats_cover_rate);
      document.getElementById("model-win-rate").textContent = fmtPct(spread.win_rate);
      document.getElementById("model-sample").textContent = fmtCount(data.games_total);
      const asOf = data.as_of_utc ? `As of ${data.as_of_utc}` : "";
      document.getElementById("model-asof").textContent = asOf;

      const seasonTable = document.getElementById("model-season-table");
      seasonTable.innerHTML = "";
      const seasons = data.seasons || {};
      const seasonKeys = Object.keys(seasons).sort().reverse();
      for (const season of seasonKeys) {
        const row = seasons[season] || {};
        const spreadRow = row.spread || {};
        const totalRow = row.total || {};
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${season}</td>
          <td>${fmtNumber(spreadRow.mae)}</td>
          <td>${fmtNumber(spreadRow.rmse)}</td>
          <td>${fmtPct(spreadRow.ats_cover_rate)}</td>
          <td>${fmtNumber(totalRow.mae)}</td>
          <td>${fmtNumber(totalRow.rmse)}</td>
        `;
        seasonTable.appendChild(tr);
      }

      const bucketTable = document.getElementById("model-bucket-table");
      bucketTable.innerHTML = "";
      const buckets = data.buckets || {};
      const bucketKeys = Object.keys(buckets);
      for (const bucket of bucketKeys) {
        const row = buckets[bucket] || {};
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${bucket}</td>
          <td>${fmtPct(row.win_rate)}</td>
          <td>${row.games ?? "-"}</td>
        `;
        bucketTable.appendChild(tr);
      }
    };

    fetch(`${METRICS_URL}?cachebust=${Date.now()}`)
      .then((resp) => resp.json())
      .then(updateMetrics)
      .catch(() => {
        document.getElementById("metric-asof").textContent = "Metrics unavailable.";
      });

    fetch(`${MODEL_METRICS_URL}?cachebust=${Date.now()}`)
      .then((resp) => resp.json())
      .then(updateModelMetrics)
      .catch(() => {
        document.getElementById("model-asof").textContent = "Metrics unavailable.";
      });
  </script>
</body>
</html>
