name: New Model Odds Snapshots

on:
  schedule:
    - cron: "*/15 * * * *" # every 15 minutes
  workflow_dispatch:

permissions:
  contents: read

jobs:
  collect-odds:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          ref: master

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: |
          if [ -f new_model/requirements.txt ]; then
            pip install -r new_model/requirements.txt
          fi

      - name: Collect games and odds for today
        env:
          BALLDONTLIE_API_KEY: ${{ secrets.BALLDONTLIE_API_KEY }}
        run: |
          TODAY=$(date -u +%Y-%m-%d)
          python new_model/src/games_collector.py --date $TODAY
          python new_model/src/odds_collector.py --date $TODAY --once

      - name: Archive new_model data
        uses: actions/upload-artifact@v4
        with:
          name: new-model-db
          path: new_model/data/
